<html>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <style>
      .passed { color: #39aa56; }
      .failed { color: #db4545; }
    </style>
  </head>
  <body>
    <h1>The coding game - Hall of fame</h1>
    <ul id="players">
    </ul>
    
    <script>
      var players = ['ericminio', 'yosethegame'];
      var levels = ['thecodinggame-javascript-1', 'thecodinggame-javascript-2'];       
      
      $.each(players, function(playerIndex, player) {
        var results = [];
        var calls = [];

        var api = 'https://api.travis-ci.org/repos/' + player + '/';
        $.each(levels, function(index, repo) {
          results[index] = 0;
          var target = api + repo + '.json';        
          var call = $.ajax({
            url: target,
            dataType: 'json',
            success: function(data) { results[index] = (1-data.last_build_result); }
          });
          console.log('pushing call for repo ' + repo + ' for player ' + player);
          calls.push(call);
        });
        
        $.when.apply($, calls).done(function() {
          console.log('render for player ' + player);
          var score = 0;            
          $.each(levels, function(index, repo) { score += results[index]; });
          var item = '<li>'+ player + ':' + score +'</li>';          
          $('#players').append(item);
        });
      });
    </script>
  </body>
</html>
